<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Breath of the Wild Quiz</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: 'Segoe UI', system-ui, sans-serif;
      background: #1a1a2e;
      color: #e0e0e0;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
    }

    .container {
      max-width: 640px;
      width: 100%;
    }

    h1 {
      text-align: center;
      color: #7ec8e3;
      font-size: 1.8rem;
      margin-bottom: 8px;
    }

    .subtitle {
      text-align: center;
      color: #888;
      margin-bottom: 24px;
      font-size: 0.95rem;
    }

    /* Difficulty filter */
    .filters {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-bottom: 24px;
      flex-wrap: wrap;
    }

    .filters label {
      cursor: pointer;
      padding: 6px 16px;
      border-radius: 20px;
      font-size: 0.85rem;
      font-weight: 600;
      transition: opacity 0.2s;
    }

    .filters input { display: none; }
    .filters input:not(:checked) + span { opacity: 0.4; }

    .badge-easy   { background: #2d6a4f; color: #b7e4c7; }
    .badge-medium { background: #6a4c2d; color: #e4d5b7; }
    .badge-hard   { background: #6a2d2d; color: #e4b7b7; }

    /* Progress bar */
    .progress-bar {
      height: 6px;
      background: #2a2a4a;
      border-radius: 3px;
      margin-bottom: 20px;
      overflow: hidden;
    }

    .progress-fill {
      height: 100%;
      background: #7ec8e3;
      border-radius: 3px;
      transition: width 0.4s ease;
      width: 0%;
    }

    .status {
      display: flex;
      justify-content: space-between;
      font-size: 0.85rem;
      color: #888;
      margin-bottom: 12px;
    }

    /* Quiz card */
    .card {
      background: #16213e;
      border-radius: 12px;
      padding: 28px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.3);
    }

    .difficulty-tag {
      display: inline-block;
      padding: 3px 12px;
      border-radius: 12px;
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
      margin-bottom: 14px;
    }

    .question-text {
      font-size: 1.15rem;
      line-height: 1.5;
      margin-bottom: 20px;
    }

    .options {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .option-btn {
      background: #1a1a2e;
      border: 2px solid #2a2a4a;
      border-radius: 8px;
      padding: 12px 16px;
      color: #e0e0e0;
      font-size: 1rem;
      cursor: pointer;
      text-align: left;
      transition: border-color 0.2s, background 0.2s;
    }

    .option-btn:hover:not(:disabled) {
      border-color: #7ec8e3;
      background: #1e2a4a;
    }

    .option-btn:disabled { cursor: default; }
    .option-btn.correct { border-color: #2d6a4f; background: #1a3a2a; color: #b7e4c7; }
    .option-btn.wrong   { border-color: #6a2d2d; background: #3a1a1a; color: #e4b7b7; }

    .next-btn {
      margin-top: 20px;
      width: 100%;
      padding: 12px;
      background: #7ec8e3;
      color: #1a1a2e;
      border: none;
      border-radius: 8px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.2s;
    }

    .next-btn:hover { background: #5fb8d9; }

    /* Results screen */
    .results {
      text-align: center;
    }

    .results .score {
      font-size: 3rem;
      font-weight: 700;
      color: #7ec8e3;
      margin: 16px 0 8px;
    }

    .results .message {
      font-size: 1.1rem;
      color: #aaa;
      margin-bottom: 24px;
    }

    .hidden { display: none; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Breath of the Wild Quiz</h1>
    <p class="subtitle">Test your knowledge of Hyrule</p>

    <!-- Difficulty filters -->
    <div class="filters" id="filters">
      <label class="badge-easy">
        <input type="checkbox" value="easy" checked><span>Easy</span>
      </label>
      <label class="badge-medium">
        <input type="checkbox" value="medium" checked><span>Medium</span>
      </label>
      <label class="badge-hard">
        <input type="checkbox" value="hard" checked><span>Hard</span>
      </label>
    </div>

    <!-- Start screen -->
    <div class="card" id="start-screen">
      <p class="question-text" style="text-align:center;">Select your difficulty filters above, then begin!</p>
      <p id="start-info" style="text-align:center;color:#888;font-size:0.85rem;margin-bottom:16px;"></p>
      <button class="next-btn" id="start-btn">Start Quiz</button>
    </div>

    <!-- Quiz screen -->
    <div class="hidden" id="quiz-screen">
      <div class="status">
        <span id="question-counter">Question 1 / 10</span>
        <span id="score-display">Score: 0</span>
      </div>
      <div class="progress-bar"><div class="progress-fill" id="progress"></div></div>
      <div class="card">
        <span class="difficulty-tag" id="diff-tag"></span>
        <p class="question-text" id="question"></p>
        <div class="options" id="options"></div>
        <button class="next-btn hidden" id="next-btn">Next Question</button>
      </div>
    </div>

    <!-- Results screen -->
    <div class="card hidden" id="results-screen">
      <div class="results">
        <p class="question-text">Quiz Complete!</p>
        <p class="score" id="final-score"></p>
        <p class="message" id="final-message"></p>
        <p id="remaining-info" class="hidden" style="color:#888;font-size:0.85rem;margin-bottom:16px;"></p>
        <button class="next-btn" id="restart-btn">Play Again</button>
      </div>
    </div>
  </div>

  <script>
    let allQuestions = [];
    let quiz = [];
    let current = 0;
    let score = 0;
    const SEEN_KEY = 'zquiz-seen';

    const $ = id => document.getElementById(id);

    function getSeenQuestions() {
      try { return JSON.parse(localStorage.getItem(SEEN_KEY)) || []; }
      catch { return []; }
    }

    function markSeen(question) {
      const seen = getSeenQuestions();
      if (!seen.includes(question)) {
        seen.push(question);
        localStorage.setItem(SEEN_KEY, JSON.stringify(seen));
      }
    }

    function resetSeen() {
      localStorage.removeItem(SEEN_KEY);
    }

    // Load questions
    fetch('questions.json')
      .then(r => r.json())
      .then(data => { allQuestions = data; updateStartInfo(); })
      .catch(() => { $('start-screen').innerHTML = '<p class="question-text">Failed to load questions.</p>'; });

    function updateStartInfo() {
      const diffs = getSelectedDifficulties();
      const filtered = allQuestions.filter(q => diffs.includes(q.difficulty));
      const seen = getSeenQuestions();
      const unseen = filtered.filter(q => !seen.includes(q.question)).length;
      $('start-info').textContent = `${unseen} new question${unseen !== 1 ? 's' : ''} available (${filtered.length} total)`;
    }

    // Filter checkbox styling
    document.querySelectorAll('#filters input').forEach(cb => {
      cb.addEventListener('change', () => {
        cb.nextElementSibling.style.opacity = cb.checked ? '1' : '0.4';
        if (allQuestions.length) updateStartInfo();
      });
    });

    function getSelectedDifficulties() {
      return [...document.querySelectorAll('#filters input:checked')].map(cb => cb.value);
    }

    function shuffle(arr) {
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
      return arr;
    }

    function startQuiz() {
      const diffs = getSelectedDifficulties();
      if (diffs.length === 0) return alert('Select at least one difficulty.');
      const filtered = allQuestions.filter(q => diffs.includes(q.difficulty));
      if (filtered.length === 0) return alert('No questions match your filters.');

      const seen = getSeenQuestions();
      let unseen = filtered.filter(q => !seen.includes(q.question));

      if (unseen.length === 0) {
        resetSeen();
        unseen = [...filtered];
      }

      quiz = shuffle(unseen);
      current = 0;
      score = 0;
      $('start-screen').classList.add('hidden');
      $('filters').classList.add('hidden');
      $('results-screen').classList.add('hidden');
      $('quiz-screen').classList.remove('hidden');
      showQuestion();
    }

    function showQuestion() {
      const q = quiz[current];
      $('question-counter').textContent = `Question ${current + 1} / ${quiz.length}`;
      $('score-display').textContent = `Score: ${score}`;
      $('progress').style.width = `${(current / quiz.length) * 100}%`;

      const tag = $('diff-tag');
      tag.textContent = q.difficulty;
      tag.className = 'difficulty-tag badge-' + q.difficulty;

      $('question').textContent = q.question;
      $('next-btn').classList.add('hidden');

      const optionsEl = $('options');
      optionsEl.innerHTML = '';
      q.options.forEach((opt, i) => {
        const btn = document.createElement('button');
        btn.className = 'option-btn';
        btn.textContent = opt;
        btn.addEventListener('click', () => selectAnswer(i, q.answer));
        optionsEl.appendChild(btn);
      });
    }

    function selectAnswer(selected, correct) {
      const buttons = document.querySelectorAll('.option-btn');
      buttons.forEach((btn, i) => {
        btn.disabled = true;
        if (i === correct) btn.classList.add('correct');
        if (i === selected && selected !== correct) btn.classList.add('wrong');
      });
      if (selected === correct) score++;
      $('score-display').textContent = `Score: ${score}`;
      markSeen(quiz[current].question);
      $('next-btn').classList.remove('hidden');
    }

    function nextQuestion() {
      current++;
      if (current < quiz.length) {
        showQuestion();
      } else {
        showResults();
      }
    }

    function showResults() {
      $('quiz-screen').classList.add('hidden');
      $('results-screen').classList.remove('hidden');
      const pct = Math.round((score / quiz.length) * 100);
      $('final-score').textContent = `${score} / ${quiz.length}`;
      let msg = '';
      if (pct === 100) msg = 'Perfect! A true Champion!';
      else if (pct >= 80) msg = 'Impressive! Impa would be proud.';
      else if (pct >= 60) msg = 'Not bad, but Hyrule still needs saving.';
      else if (pct >= 40) msg = 'You might want to revisit some memories.';
      else msg = 'Looks like you just woke up from the Shrine of Resurrection.';
      $('final-message').textContent = msg;
      updateResultsInfo();
    }

    function updateResultsInfo() {
      const diffs = getSelectedDifficulties();
      const filtered = allQuestions.filter(q => diffs.includes(q.difficulty));
      const seen = getSeenQuestions();
      const remaining = filtered.filter(q => !seen.includes(q.question)).length;
      $('remaining-info').textContent = remaining > 0
        ? `${remaining} unseen question${remaining !== 1 ? 's' : ''} remaining`
        : 'You\'ve seen all questions! Next round will reset.';
      $('remaining-info').classList.remove('hidden');
    }

    function restart() {
      $('results-screen').classList.add('hidden');
      $('remaining-info').classList.add('hidden');
      $('filters').classList.remove('hidden');
      $('start-screen').classList.remove('hidden');
      updateStartInfo();
    }

    $('start-btn').addEventListener('click', startQuiz);
    $('next-btn').addEventListener('click', nextQuestion);
    $('restart-btn').addEventListener('click', restart);
  </script>
</body>
</html>
